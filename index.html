<!doctype html>
<meta charset=utf-8>
<title>Awesome web page</title>

<textarea id="id1" cols="50" rows="30"></textarea>
<form>
    <label for="male">Wonderful search box</label>
    <input type="text" id="id2">
  </form> 
<pre><code id="res"></code></pre>
<script>
if (window.Worker) {
    //Create our web worker
    const worker = new Worker('./dist/worker.js');

    const textElm = document.querySelector('#id1');
    const queryElm = document.querySelector('#id2');
    const codeElm = document.querySelector('#res');

    // Just send message on each keyup event
    queryElm.addEventListener('keyup', e => send());

    const getJson = (data) => {
        try {
            return JSON.parse(data);
        } catch (e) {
            return {};
        }
    }

    // Send json and query to process to our web worker
    const send = () => {
        const query = queryElm.value
        const json = getJson(textElm.value);
        worker.postMessage({json, query});
    };

    worker.onmessage = (e) => {
        codeElm.textContent = JSON.stringify(e.data);
    } 
} else {
    console.warn("No web worker support ðŸ˜¥");
}
</script>